# ShinePet

一个可爱、可拖拽的浏览器插件电子宠物。它会在你的网页上陪伴你浏览，支持多种可爱动作和智能显示控制。

## 动画系统

ShinePet 包含5种不同的动画状态：

| 动画 | 触发方式 | 描述 |
|------|---------|------|
| 🧘 **静止 (Idle)** | 默认状态 | 轻微上下浮动，表示静静陪伴 |
| 👋 **挥手 (Wave)** | 单击（随机） | 多帧动画：右手→左手→双手，完成后回到静止 |
| 🔄 **旋转 (Spin)** | 单击（随机） | 原地转一圈（顺/逆时针随机），随后回到静止 |
| 🚶 **走路 (Walk)** | 双击宠物 | 随机方向移动，3秒内完成移动→回归静止 |
| 😲 **拖动 (Drag)** | 拖拽时 | 张大嘴巴的惊讶表情，拖动结束后自动恢复 |

## 使用方式

### 基本交互
- 🖱️ **拖动**：按住宠物即可拖拽到任意位置，拖动时显示惊讶表情，位置会自动保存
- 👆 **单击**：随机“挥手”或“转圈一圈（方向随机）”
- 👆👆 **双击**：触发走路动画（随机方向移动），约3秒后回到静止
- 🖱️ **右键**：打开设置页面
- 🔵 **扩展图标**：点击扩展图标切换宠物显示/隐藏状态

### 显示控制
- **🔵 蓝色图标** = 宠物正在显示
- **⚫ 灰色图标** = 宠物已隐藏
- 点击扩展图标即可在显示/隐藏状态间切换
- 状态会在所有标签页间同步

### 交互逻辑
- **单击随机**：50% 挥手，50% 原地转一圈（顺/逆时针随机）
  - 转圈仅为视觉旋转，不改变宠物位置
- **双击走路**：双击时宠物会随机选择方向移动一段距离后回归原位
- **拖动动画**：拖动超过5像素阈值时自动切换到惊讶表情，松手后恢复静止状态
- **智能交互**：拖动和点击能够准确区分，避免误触发动画
- **自动回归**：走路动画3秒后自动返回静止状态
- **双击优先**：双击走路会打断当前任何动画，包含随机方向移动

### 天气功能
- 宠物上方显示实时天气信息
- 可在设置页面开关天气显示
- 支持自动定位或手动设置城市

### 测试页面
打开 `animation-test.html` 可以预览所有动画状态。
## 功能特性

- 🐾 **可爱常驻**：在网页上以悬浮层形式出现，不遮挡主要内容
- 🎯 **自由拖动**：按住即可拖拽，位置持久化保存
- 🎭 **多种动画**：静止、挥手、转圈、走路等多种生动动作
- 🎮 **丰富交互**：点击/双击触发不同动画，走路时真实移动
- 👁️ **智能显隐**：点击扩展图标快速切换显示/隐藏，状态同步所有标签页
- 🌤️ **实时天气**：显示当前天气信息（可开关）
- ⚙️ **个性化设置**：位置、天气显示等可配置
- 🚀 **轻量稳定**：不影响页面性能，低资源占用

## 预览

（占位：在此放置 GIF 或截图，例如 `docs/demo.gif`）

## 安装

当前处于开发阶段，推荐以“加载已解压的扩展”方式安装：

1. 克隆项目：
   ```bash
   git clone https://github.com/<your-org-or-name>/ShinePet.git
   ```
2. 在浏览器中打开扩展页面：
   - Chrome/Edge：地址栏输入 `chrome://extensions/` 或 `edge://extensions/`
   - 打开“开发者模式” → “加载已解压的扩展程序” → 选择项目根目录（含 `manifest.json`）

发布版将提供商店地址与一键安装方式。

## 使用方式（交互设计）

- 拖动：按住宠物即可拖拽，靠近屏幕边缘会吸附停靠
- 单击：切换到下一个轻量动作（如挥手）
- 双击：触发跳舞等高能量动作（带可选音效）
- 右键：打开设置页面
- 休息：拖到页面底部停留可进入“睡觉”状态
- 持久化：位置、大小、音量等会在 `chrome.storage.sync` 中保存

### 小游戏：踢足球（试验）

- 在页面按 `Alt + S` 打开/关闭全屏小游戏
- 面板可设置：球门宽度、射门力度、角度，实时显示轨迹预览
- 点击“开始”射门，飞行过程中绘制实际轨迹；落地后判断是否进球

## 权限与安全

计划申请（以 MV3 为准，最终以实现为准）：

- `storage`：保存用户设置与宠物状态
- `scripting`：向页面注入悬浮层（内容脚本/脚本 API）
- `activeTab`（可选）：在当前活动页快速启用/禁用
- `geolocation`（仅浏览器提示授权时使用）：获取当前位置用于天气
- `contextMenus`（不使用扩展级 API，改为页面内自定义右键菜单）
- `alarms`（未使用）：当前以页面内 `setInterval` 实现 2 小时刷新

本扩展不收集个人敏感信息，所有数据保存在本机或同步到用户浏览器账户。

## 自定义与扩展（规划）

- 皮肤与素材：
  - 路径结构示例：`/assets/pets/<pet-id>/sprite.png`、`/assets/pets/<pet-id>/config.json`
  - `config.json` 中定义动作名称、帧率、帧序列、碰撞盒、音效绑定等
  - 简单皮肤切换：当前实现将优先加载 `assets/pikachu.svg`，若不存在则回退到 `assets/pet.svg`
- 行为配置：
  - 通过 `behaviors.json`（或等价模块）声明可用动作与触发条件
- 设置面板：
  - 尺寸、透明度、层级、吸附开关、随机卖萌频率、音量

## 技术方案（拟定）

- Manifest V3 浏览器扩展
- TypeScript + 轻量渲染（Canvas/CSS Sprite）
- 构建：Vite 或等效工具产出 `dist`
- 质量保障：ESLint、Prettier

### 天气与皮肤说明

- 天气来源：Open‑Meteo `https://api.open-meteo.com/` 与地理编码 `https://geocoding-api.open-meteo.com/`
- 刷新频率：每 2 小时自动刷新；可在右键菜单中“立即刷新”
- 定位优先级：手动设置城市 > 浏览器定位 > 不显示
- 数据缓存：`chrome.storage.sync` 持久化最近一次天气与时间戳
- 徽标显示：在宠物右上角展示表情 + 温度（如 `☀️ 26°C`）
- 皮肤：默认优先加载 `assets/mc_person.svg` 像素风；如不存在则回退到 `assets/pet.svg`

最终选型将以实现阶段的约束与性能为准，README 会同步更新。

## 目录结构

```
ShinePet/
  ├─ assets/                  # 宠物素材与配置（pet.svg 等）
  ├─ src/                     # 源码（内容脚本、样式等） 
  │   ├─ content.js
  │   └─ content.css
  ├─ manifest.json            # MV3 清单
  ├─ README.md
  └─ LICENSE
```

## 开发指南（将随实现补充）

当前阶段无需构建，直接在浏览器扩展页面加载项目根目录进行调试。后续将引入工具链（如 Vite + TS）并更新命令：

1. 直接加载根目录（包含 `manifest.json`）调试内容脚本效果
2. 修改 `src/content.js` 与 `src/content.css` 可立即生效（刷新页面/扩展）
3. 引入构建后将提供 `dev`/`build` 命令与更完善的目录结构

## 路线图
## 版本

- v0.2.0
  - 新增：右键菜单“开启/关闭足球游戏”“打开设置”
  - 新增：Alt+S 冲突改为右键菜单触发足球小游戏
  - 优化：天气启用增加“保存设置”按钮（选项页）
  - 皮肤：默认像素风 `mc_person.svg`
  - 修复：storage 读取容错，避免 iterable 报错


- v0.1 原型：基础悬浮层、拖拽、两三个动作、位置持久化
- v0.2 互动：点击/双击触发、快捷菜单、静音与缩放
- v0.3 个性化：换肤与动作配置、吸附/物理开关
- v0.4 增强：节奏跳舞（跟随音乐/系统音）、定时提醒、更多动作
- v1.0 发布：性能优化、适配主流 Chromium 浏览器与商店上架

## 贡献

欢迎 Issue 与 PR。请遵循 Conventional Commits（如 `feat:`、`fix:`、`docs:` 等），并确保通过基础校验（Lint/Build）。

## 许可

本项目使用 MIT License，详见 `LICENSE`。

